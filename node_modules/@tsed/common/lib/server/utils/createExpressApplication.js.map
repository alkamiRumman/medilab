{"version":3,"sources":["server/utils/createExpressApplication.ts"],"names":[],"mappings":";;AAAA,iCAA0E;AAC1E,mCAAmC;AACnC,mCAAyC;AACzC,yEAAoE;AAEpE,SAAgB,wBAAwB,CAAC,QAAyB;IAChE,QAAQ,CAAC,YAAY,CAAC,uCAAkB,CAAC,CAAC;AAC5C,CAAC;AAFD,4DAEC;AAED,qBAAgB,CAAC;IACf,OAAO,EAAE,uCAAkB;IAC3B,IAAI,EAAE,CAAC,oBAAe,CAAC;IACvB,KAAK,EAAE,kBAAa,CAAC,SAAS;IAC9B,MAAM,EAAE,IAAI;IACZ,UAAU,CAAC,QAAyB;QAClC,MAAM,UAAU,GAAG,OAAO,EAAE,CAAC;QAC7B,MAAM,WAAW,GAAG,UAAU,CAAC,GAAG,CAAC;QAEnC,UAAU,CAAC,GAAG,GAAG,UAAS,GAAG,IAAW;YACtC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;gBACpB,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;oBACrB,GAAG,GAAG,oBAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;iBAChD;gBAED,OAAO,GAAG,CAAC;YACb,CAAC,CAAC,CAAC;YAEH,OAAO,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC;QACzC,CAAC,CAAC;QAEF,OAAO,UAAU,CAAC;IACpB,CAAC;CACF,CAAC,CAAC","file":"createExpressApplication.js","sourcesContent":["import {InjectorService, ProviderScope, registerProvider} from \"@tsed/di\";\nimport * as Express from \"express\";\nimport {HandlerBuilder} from \"../../mvc\";\nimport {ExpressApplication} from \"../decorators/expressApplication\";\n\nexport function createExpressApplication(injector: InjectorService): void {\n  injector.forkProvider(ExpressApplication);\n}\n\nregisterProvider({\n  provide: ExpressApplication,\n  deps: [InjectorService],\n  scope: ProviderScope.SINGLETON,\n  global: true,\n  useFactory(injector: InjectorService) {\n    const expressApp = Express();\n    const originalUse = expressApp.use;\n\n    expressApp.use = function(...args: any[]) {\n      args = args.map(arg => {\n        if (injector.has(arg)) {\n          arg = HandlerBuilder.from(arg).build(injector);\n        }\n\n        return arg;\n      });\n\n      return originalUse.call(this, ...args);\n    };\n\n    return expressApp;\n  }\n});\n"],"sourceRoot":"../../../src"}